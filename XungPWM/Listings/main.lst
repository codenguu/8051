C51 COMPILER V9.60.0.0   MAIN                                                              10/07/2023 14:54:09 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "main.h"
   2          #include "../lib/delay.h"
   3          
   4          #define up 0
   5          #define down 1
   6          
   7          sbit BTN = P1^0;
   8          
   9          unsigned int T, Th, Tl;
  10          unsigned char Ton_h_reload, Ton_l_reload, Toff_h_reload, Toff_l_reload;
  11          
  12          void PWM_START()
  13          {
  14   1        TR1 = 1;
  15   1      }
  16          
  17          void PWM_STOP()
  18          {
  19   1        TR1 = 0;
  20   1      }
  21          
  22          //ck(us)
  23          void PWM_Init(unsigned int ck)
  24          {
  25   1        P2_0 = 1;
  26   1        TMOD = 0x0F;    //Xoa di cac mode cua Timer1;
  27   1        TMOD = 0x10;    //Tiemr0 mode 1;16bit
  28   1        
  29   1        ET1 = 1;    //cho phep ngat timer1
  30   1        EA = 1;     //cho phep ngat toan cuc
  31   1        
  32   1        T = ck;
  33   1        Th  = T/2;
  34   1        Tl = T - Th ; 
  35   1        
  36   1        Ton_h_reload = (65536 - Th) >> 8;     //thoi gian o muc 1;
  37   1        Ton_l_reload = (65536 - Th) & 0x00FF; //thoi gian o muc 1;
  38   1        
  39   1        Toff_h_reload = (65536 - Tl) >> 8;      //thoi gian o muc 0;
  40   1        Toff_l_reload = (65536 - Tl) & 0x00FF;      //thoi gian o muc 0;
  41   1        
  42   1        
  43   1          // hien tai P2_0 dang muc 1;
  44   1        TH1 = Ton_h_reload ;
  45   1        TL1 = Ton_l_reload ;
  46   1        
  47   1      }
  48          
  49          //cycle duty
  50          void PWM_set_Duty(unsigned char duty)
  51          {
  52   1        if(duty == 0){
  53   2          P2_0 = 0;
  54   2          ET1 = 0;
C51 COMPILER V9.60.0.0   MAIN                                                              10/07/2023 14:54:09 PAGE 2   

  55   2        }
  56   1        else if(duty == 100){
  57   2          P2_0 = 1;
  58   2          ET1 = 0;
  59   2        }
  60   1        else 
  61   1        {
  62   2          Th = (unsigned long)T*duty/100;
  63   2          
  64   2          Tl = T - Th;
  65   2          
  66   2          Ton_h_reload = (65536 - Th) >> 8;     //thoi gian o muc 1;
  67   2          Ton_l_reload = (65536 - Th) & 0x00FF; //thoi gian o muc 1;
  68   2          
  69   2          Toff_h_reload = (65536 - Tl) >> 8;      //thoi gian o muc 0;
  70   2          Toff_l_reload = (65536 - Tl) & 0x00FF;      //thoi gian o muc 0;
  71   2          
  72   2          ET1 = 1;
  73   2        }
  74   1        
  75   1      }
  76          
  77          void main(){
  78   1        unsigned char dir = up , duty = 0;
  79   1        PWM_Init(10000);
  80   1        PWM_set_Duty(duty);
  81   1        PWM_START();
  82   1        
  83   1        while(1){
  84   2          if(dir == up){
  85   3            if(BTN == 0){
  86   4              duty += 10;
  87   4              while(BTN == 0);
  88   4              if(duty == 100){
  89   5                dir = down;
  90   5            }
  91   4          }
  92   3          }
  93   2          else if(dir == down){
  94   3            if(BTN == 0){
  95   4              duty -= 10;
  96   4              while(BTN == 0);
  97   4              if(duty == 0){
  98   5                dir = up;
  99   5              }
 100   4            }
 101   3          }
 102   2          PWM_set_Duty(duty);
 103   2        }
 104   1      
 105   1      }
 106          
 107          void ISR_PWM(void) interrupt 3
 108          {
 109   1      
 110   1        P2_0 = !P2_0;
 111   1        if(P2_0 == 0)
 112   1        {
 113   2          TH1 = Toff_h_reload ;
 114   2          TL1 = Toff_l_reload ;
 115   2        }
 116   1        else 
C51 COMPILER V9.60.0.0   MAIN                                                              10/07/2023 14:54:09 PAGE 3   

 117   1        {
 118   2          TH1 = Ton_h_reload;
 119   2          TL1 = Ton_l_reload;
 120   2        }
 121   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    357    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
