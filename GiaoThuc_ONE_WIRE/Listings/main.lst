C51 COMPILER V9.60.0.0   MAIN                                                              10/12/2023 01:27:38 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "main.h"
   2          #include "../lib/delay.h"
   3          #include "../lib/delay_us.h"
   4          
   5          #define DS18B20_SKIP_ROM            0xCC
   6          #define DS18B20_CONVERT_T           0x44
   7          #define DS18B20_READ_SCRATCH_PAD    0xBE
   8          
   9          
  10          sbit DS18B20_PIN = P1^0;
  11          
  12          unsigned char code arrLED[]={0x3f, 0x6, 0x5b, 0x4f, 0x66, 0x6d,0x7d, 0x07, 0x7f, 0x6f };
  13          
  14          unsigned char DS18B20_Reset();
  15          void DS18B20_Write0();
  16          void DS18B20_Write1();
  17          void DS18B20_Write_bit(unsigned char b);
  18          unsigned char DS18B20_Read_bit();
  19          void DS18B20_Write_byte(unsigned char b);
  20          unsigned char DS18B20_Read_byte();
  21          
  22           
  23          void main(){
  24   1        unsigned int temp;
  25   1        unsigned char int_part, decimal_part ;
  26   1        unsigned char chuc , donvi;
  27   1        
  28   1        TMOD |= 0x10;
  29   1        while(1){
  30   2          while(DS18B20_Reset());
  31   2          DS18B20_Write_byte(DS18B20_SKIP_ROM);
  32   2          DS18B20_Write_byte(DS18B20_CONVERT_T);
  33   2          
  34   2          
  35   2          Delay(750);
  36   2          
  37   2          while(DS18B20_Reset());
  38   2          DS18B20_Write_byte(DS18B20_SKIP_ROM);
  39   2          DS18B20_Write_byte(DS18B20_READ_SCRATCH_PAD);
  40   2          
  41   2          temp = DS18B20_Read_byte();
  42   2          temp = (DS18B20_Read_byte() << 8 ) | temp ;
  43   2        
  44   2          int_part  = temp >> 4;
  45   2          chuc = int_part /10;
  46   2          donvi = int_part % 10;
  47   2          
  48   2          decimal_part = temp & 0x000F;
  49   2          decimal_part = decimal_part * 10/16;
  50   2          
  51   2          P0 = arrLED[chuc];
  52   2          P2 = arrLED[donvi];
  53   2          P3 = arrLED[decimal_part];
  54   2        }
C51 COMPILER V9.60.0.0   MAIN                                                              10/12/2023 01:27:38 PAGE 2   

  55   1      
  56   1      }
  57          
  58          unsigned char DS18B20_Reset()
  59          {
  60   1        unsigned char result;
  61   1      
  62   1        DS18B20_PIN = 0;
  63   1        Delay_us(480);
  64   1        
  65   1        DS18B20_PIN = 1;
  66   1        Delay_us(70);
  67   1        
  68   1        result = DS18B20_PIN;
  69   1        Delay_us(410);
  70   1        
  71   1        return result;
  72   1        
  73   1      }
  74          
  75          void DS18B20_Write0(){
  76   1        DS18B20_PIN = 0;
  77   1        Delay_us(60);
  78   1        DS18B20_PIN = 1;
  79   1        Delay_us(10);
  80   1      
  81   1      }
  82          
  83          void DS18B20_Write1(){
  84   1        DS18B20_PIN = 0;
  85   1        Delay_us(6);
  86   1        
  87   1        DS18B20_PIN = 1;
  88   1        Delay_us(64);
  89   1      
  90   1      }
  91          
  92          
  93          void DS18B20_Write_bit(unsigned char b){
  94   1        if(b == 1){
  95   2          DS18B20_Write1();
  96   2        }
  97   1        else 
  98   1        {
  99   2          DS18B20_Write0();
 100   2        }
 101   1      }
 102          
 103          unsigned char DS18B20_Read_bit()
 104          { 
 105   1        unsigned char result;
 106   1        DS18B20_PIN = 0;
 107   1        Delay_us(6);
 108   1        
 109   1        DS18B20_PIN = 1;
 110   1        Delay_us(9);
 111   1        
 112   1        result = DS18B20_PIN;
 113   1        Delay_us(55);
 114   1        
 115   1        return result;
 116   1      }
C51 COMPILER V9.60.0.0   MAIN                                                              10/12/2023 01:27:38 PAGE 3   

 117          
 118          void DS18B20_Write_byte(unsigned char b){
 119   1        unsigned char i = 8;
 120   1        
 121   1        while(i--){
 122   2          DS18B20_Write_bit(b & 0x01);
 123   2          b >>= 1;
 124   2        }
 125   1      }
 126          
 127          unsigned char DS18B20_Read_byte()
 128          {
 129   1        unsigned char i = 8 , result = 0;
 130   1        
 131   1        while(i--){
 132   2          result >>= 1;
 133   2          result = (DS18B20_Read_bit() << 7); //GUI BIT CAO TRUOC NEN PHAI NHAN BIT CAO TRUOC
 134   2          
 135   2          //0000 0001 << 7 = 1000 0000;
 136   2        }
 137   1        return result;
 138   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    298    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
